document.addEventListener("DOMContentLoaded",()=>{const target=document.querySelector(".threed_buttons");if(target){const modelId=target.dataset.modelid;const encodedId=btoa(modelId.toString());fetch('https://ncr.preqservices.com/ajax/models/get-models.php?action=checkstatus&modelid='+encodedId).then(response=>response.json()).then(data=>{if(data.status==='Active'){target.style.display='block'}else{target.style.display='none'}}).catch(error=>{console.error("Error fetching model status:",error)})}const style=document.createElement("style");style.textContent=`.btn{background-color:#007bff;color:#fff;padding:10px 20px;border:none;border-radius:5px;font-size:16px;cursor:pointer}.btn:hover{background-color:#0056b3}.custom-modal{display:none;position:fixed;z-index:9999;inset:0;background-color:rgb(0 0 0 / .6);justify-content:center;align-items:center}.modal-box{background:#fff;width:80%;max-width:1000px;border-radius:12px;overflow:hidden;display:flex;flex-direction:column}.modal-header{display:flex;justify-content:flex-end;padding:10px}.close-btn{font-size:28px;cursor:pointer;border:none;background:none}model-viewer{width:100%;height:500px}.model-id{text-align:center;padding:10px 0;font-weight:700;font-size:16px;color:#007bff}.modal-footer{display:flex;justify-content:space-around;padding:10px;border-top:1px solid #ccc;background-color:#f9f9f9;font-size:14px}.footer-icon{text-align:center;color:#333;cursor:pointer}.footer-icon span{display:block;font-size:12px;margin-top:4px}`;document.head.appendChild(style);const script=document.createElement("script");script.type="module";script.src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js";document.head.appendChild(script);const modal=document.createElement("div");modal.className="custom-modal";modal.style.display="none";modal.innerHTML=` <div class="modal-box"><div class="modal-header"><button class="close-btn" title="Close">&times;</button></div><model-viewer id="viewer3D" src="" alt="3D model" camera-controls auto-rotate ar></model-viewer><div class="model-id" id="modelIdText">MODEL-ID</div><div class="modal-footer"><div class="footer-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-share" viewBox="0 0 16 16"><path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.5 2.5 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5m-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3"/></svg><span>Share</span></div><div class="footer-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear" viewBox="0 0 16 16"><path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0"/><path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z"/></svg><span>Settings</span></div><div class="footer-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-badge-ar" viewBox="0 0 16 16"><path d="m3.794 11 .47-1.542H6.27L6.739 11H8L5.996 5.001H4.607L2.595 11zm1.503-4.852.734 2.426h-1.52l.734-2.426zm5.598-1.147H8.5V11h1.173V8.763h1.064L11.787 11h1.327L11.91 8.583C12.455 8.373 13 7.779 13 6.9c0-1.147-.773-1.9-2.105-1.9zm-1.222 2.87V5.933h1.05c.63 0 1.05.347 1.05.989 0 .633-.408.95-1.067.95z"/><path d="M14 3a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zM2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"/></svg><span>View in AR</span></div></div></div>`;document.body.appendChild(modal);const viewer=modal.querySelector("#viewer3D");const closeBtn=modal.querySelector(".close-btn");const modelIdText=modal.querySelector("#modelIdText");document.addEventListener("click",(e)=>{const button=e.target.closest(".threed_buttons[data-modelid]");if(button){const modelId=button.dataset.modelid;const filetype=button.dataset.modeltype;const platform=navigator.platform.toLowerCase();const domain=window.location.hostname;const genKey=domain+modelId;const clientAccessKey=btoa(domain.toString());const encodedId=btoa(modelId.toString());const userAgent=navigator.userAgent;console.log('platform',platform);console.log('domain',domain);console.log('genKey',genKey);console.log('clientAccessKey',clientAccessKey);modal.style.display="flex";modelIdText.textContent=modelId;viewer.src="";fetch("https://api.ipify.org?format=json").then(response=>response.json()).then(ipData=>{fetch(`https://ncr.preqservices.com/ajax/models/get-models.php?action=getfile&platform=${platform}&domain=${domain}&modelid=${encodedId}&ip=${ipData.ip}&useragent=${userAgent}&filetype=${filetype}`).then(response=>response.json()).then(data=>{if(data.status==='Ok'&&data.file_url){viewer.src=data.file_url;console.log("Model loaded:",data.file_url)}else{console.warn("Model inactive or no file")}}).catch(error=>{console.error("Error fetching 3D model:",error)})}).catch(error=>{console.error("Error getting IP address:",error)})}if(e.target===modal||e.target===closeBtn){modal.style.display="none";viewer.src=""}})})
